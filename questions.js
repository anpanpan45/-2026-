/**
 * 宅建学習アプリ - 問題データ管理
 * 将来的に1000問規模に対応可能な構造
 */

// ============ ベース問題データ（現在の実問題50問）============
const BASE_QUESTIONS = [
    // 権利関係（12問）
    {
        id: 'Q001',
        category: "権利関係",
        q: "改正民法における共有物の管理について、共有者が単独で行える行為は次のうちどれか。",
        choices: ["共有物の全部を売却する", "共有物の保存行為（修繕等）", "共有物の性質を変更する"],
        correct: 1,
        exp: "共有物の保存行為は各共有者が単独で行うことができます。"
    },
    {
        id: 'Q002',
        category: "権利関係",
        q: "民法改正で新たに導入された『所有者不明土地の利用権』制度の目的として正しいのはどれか。",
        choices: ["所有者不明土地の完全没収", "公的利用等のための利用を可能にする", "買戻し特約の廃止"],
        correct: 1,
        exp: "所有者不明土地を公的利用や地域の利益のために利用可能にする制度です。"
    },
    {
        id: 'Q003',
        category: "権利関係",
        q: "配偶者長期居住権について、その存続期間として正しいのはどれか。",
        choices: ["5年", "10年", "終身"],
        correct: 2,
        exp: "配偶者長期居住権は配偶者が終身にわたり居住できる権利です。"
    },
    {
        id: 'Q004',
        category: "権利関係",
        q: "区分所有法における建替え決議について必要な賛成は何分の何以上か。",
        choices: ["2分の1以上", "3分の2以上", "4分の3以上"],
        correct: 2,
        exp: "区分所有法第62条により4分の3以上の賛成が必要とされています。"
    },
    {
        id: 'Q005',
        category: "権利関係",
        q: "民法における買戻し特約について、買戻期間の最大期限は法律で何年と定められているか。",
        choices: ["3年", "5年", "10年"],
        correct: 0,
        exp: "民法第579条により、買戻し特約の期間は3年を超えることができません。"
    },
    {
        id: 'Q006',
        category: "権利関係",
        q: "民法における相続欠格について、被相続人を殺害した者の相続権はどうなるか。",
        choices: ["減額される", "完全に失われる", "一定期間後に回復される"],
        correct: 1,
        exp: "相続欠格者は相続権を完全に失い、回復することはできません。"
    },
    {
        id: 'Q007',
        category: "権利関係",
        q: "民法における債権譲渡について、債務者の同意がない場合の効力として正しいのはどれか。",
        choices: ["完全に無効", "譲渡人と譲受人間では有効だが債務者に対抗できない", "債務者の異議で無効"],
        correct: 1,
        exp: "債権譲渡は債務者の同意がなくても有効ですが、通知がなければ対抗できません。"
    },
    {
        id: 'Q008',
        category: "権利関係",
        q: "民法における消滅時効（売買代金債権）の期間として正しいのはどれか。",
        choices: ["1年", "2年", "3年", "5年"],
        correct: 1,
        exp: "改正民法では売買代金債権の消滅時効は2年とされています。"
    },
    {
        id: 'Q009',
        category: "権利関係",
        q: "民法における瑕疵担保責任について責任を問える期間として最も適切なのはどれか。",
        choices: ["3ヶ月", "1年", "2年"],
        correct: 1,
        exp: "瑕疵を知った時から1年以内が責任を問える期間です。"
    },
    {
        id: 'Q010',
        category: "権利関係",
        q: "民法における占有について間接占有者の権利範囲として正しいのはどれか。",
        choices: ["物の直接的支配権を有する", "占有補助者を通じた間接的支配のみ", "完全な所有権と同等"],
        correct: 1,
        exp: "間接占有は占有補助者を通じた占有です。"
    },
    {
        id: 'Q011',
        category: "権利関係",
        q: "民法における代理権がない場合の無権代理人の責任について正しいのはどれか。",
        choices: ["本人が当然に責任を負う", "無権代理人が相手方に責任を負う", "相手方の過失により免除"],
        correct: 1,
        exp: "無権代理人は本人の追認がない限り相手方に対して責任を負います。"
    },
    {
        id: 'Q012',
        category: "権利関係",
        q: "改正民法における遺産分割協議について成人年齢引き下げの影響として正しいのはどれか。",
        choices: ["参加可能年齢が18歳以上に変更", "親の同意が常に必要", "年齢制限が廃止"],
        correct: 0,
        exp: "成人年齢の引き下げにより、18歳以上が遺産分割協議に参加できます。"
    },

    // 宅建業法（15問）
    {
        id: 'Q013',
        category: "宅建業法",
        q: "令和8年度における空き家等の売買仲介手数料の特例について800万円以下の物件の上限として正しいのはどれか。",
        choices: ["売買価格の2%", "売買価格の2.5%", "売買価格の3%"],
        correct: 1,
        exp: "2024年10月改定により、空き家等特定物件は2.5%に設定されました。"
    },
    {
        id: 'Q014',
        category: "宅建業法",
        q: "宅建業法における報酬額基準について一般的な売買仲介の計算方法として最も正しいのはどれか（取引価格1,000万円）。",
        choices: ["約30万円", "約100万円", "約165万円"],
        correct: 2,
        exp: "1,000万円の場合、(1,000-400)×3%=約180万円で、正確には約165万円です。"
    },
    {
        id: 'Q015',
        category: "宅建業法",
        q: "35条書面（重要事項説明書）に必ず記載する事項として記載不要なのはどれか。",
        choices: ["対象不動産の所在地", "購入者の年収", "契約金額"],
        correct: 1,
        exp: "購入者の個人情報（年収等）は35条書面に記載する必要がありません。"
    },
    {
        id: 'Q016',
        category: "宅建業法",
        q: "37条書面（契約書）に記載が必須でない事項として正しいのはどれか。",
        choices: ["代金及び交付方法", "購入者の勤務先", "所有権移転時期"],
        correct: 1,
        exp: "購入者の職業・勤務先は37条書面に記載義務がありません。"
    },
    {
        id: 'Q017',
        category: "宅建業法",
        q: "宅建業の免許要件について誤っているのはどれか。",
        choices: ["宅建士を常勤の従業者として置く", "事務所ごとに宅建士を5人以上置く", "営業保証金を供託する"],
        correct: 1,
        exp: "『事務所ごとに5人以上』という要件は存在しません。"
    },
    {
        id: 'Q018',
        category: "宅建業法",
        q: "35条書面の重要事項説明について説明タイミングとして正しいのはどれか。",
        choices: ["契約当日", "契約前（日数制限なし）", "入居後"],
        correct: 1,
        exp: "重要事項説明は契約成立前に宅建士により実施することが必須です。"
    },
    {
        id: 'Q019',
        category: "宅建業法",
        q: "宅建士登録の欠格事由として正しくないのはどれか。",
        choices: ["未成年者である", "心身障害がある", "禁錮刑に処せられた"],
        correct: 1,
        exp: "心身障害の有無は登録要件に含まれません。"
    },
    {
        id: 'Q020',
        category: "宅建業法",
        q: "宅建業の保証協会への加入について正しいのはどれか。",
        choices: ["全て加入が必須", "任意加入", "都市部のみ義務"],
        correct: 1,
        exp: "保証協会への加入は任意ですが、利点があります。"
    },
    {
        id: 'Q021',
        category: "宅建業法",
        q: "保証協会加入時の営業保証金供託額の減額について正しいのはどれか。",
        choices: ["10%減額", "50%減額", "75%減額"],
        correct: 1,
        exp: "保証協会加入により50%が免除されます。"
    },
    {
        id: 'Q022',
        category: "宅建業法",
        q: "宅建業者の媒介契約について有効期間の上限として正しいのはどれか。",
        choices: ["1ヶ月", "3ヶ月", "6ヶ月"],
        correct: 1,
        exp: "一般・専任媒介契約とも3ヶ月が上限です。"
    },
    {
        id: 'Q023',
        category: "宅建業法",
        q: "売買契約のクーリングオフについて適用除外となるのはどれか。",
        choices: ["購入者が宅建業者の事務所での契約", "購入者が訪問販売での契約", "事業用不動産の契約"],
        correct: 0,
        exp: "宅建業者の事務所での契約はクーリングオフ適用除外です。"
    },
    {
        id: 'Q024',
        category: "宅建業法",
        q: "宅建業法における違約金制限について手付金の額として正しいのはどれか。",
        choices: ["売買価格の5%以下", "売買価格の10%以下", "売買価格の20%以下"],
        correct: 2,
        exp: "手付金は売買価格の20%を超えてはならないと定められています。"
    },
    {
        id: 'Q025',
        category: "宅建業法",
        q: "新規従業者向けの研修について実施時期として正しいのはどれか。",
        choices: ["入社後1ヶ月以内", "入社後3ヶ月以内", "入社後6ヶ月以内"],
        correct: 0,
        exp: "新規従業者には入社後1ヶ月以内に8時間以上の研修が義務付けられています。"
    },
    {
        id: 'Q026',
        category: "宅建業法",
        q: "宅建士の更新講習について受講時期として正しいのはどれか。",
        choices: ["有効期限の30日前から", "有効期限の90日前から", "有効期限の6ヶ月前から"],
        correct: 1,
        exp: "更新講習は有効期限の3ヶ月前（90日前）から受講可能です。"
    },

    // 法令上の制限（10問）
    {
        id: 'Q027',
        category: "法令上の制限",
        q: "盛土規制法における全国一律基準について規制対象となる盛土の高さとして正しいのはどれか。",
        choices: ["1メートル以上", "2メートル以上", "3メートル以上"],
        correct: 1,
        exp: "2023年7月施行の盛土規制法では高さ2メートル以上が対象です。"
    },
    {
        id: 'Q028',
        category: "法令上の制限",
        q: "盛土規制法における許可権限者として正しいのはどれか。",
        choices: ["市町村長", "都道府県知事", "市町村長または都道府県知事"],
        correct: 2,
        exp: "許可権限が市町村長と都道府県知事に分かれています。"
    },
    {
        id: 'Q029',
        category: "法令上の制限",
        q: "農地法改正により廃止された『農地所有の下限面積要件』について従来の基準としてどうだったか。",
        choices: ["統一基準のみ", "2段階基準", "3段階以上の基準"],
        correct: 1,
        exp: "従来は市街化区域50aと市街化調整区域1haの2段階でしたが廃止されました。"
    },
    {
        id: 'Q030',
        category: "法令上の制限",
        q: "農地法4条における転用許可について許可権者として正しいのはどれか。",
        choices: ["市町村長", "都道府県知事", "農業委員会"],
        correct: 1,
        exp: "農地法4条の許可権者は都道府県知事です。"
    },
    {
        id: 'Q031',
        category: "法令上の制限",
        q: "都市計画法における開発許可の基準について市街化区域内での許可が必要な面積として正しいのはどれか。",
        choices: ["500㎡以上", "1,000㎡以上", "3,000㎡以上"],
        correct: 1,
        exp: "市街化区域内では1,000㎡以上の開発行為に許可が必要です。"
    },
    {
        id: 'Q032',
        category: "法令上の制限",
        q: "市街化調整区域での開発許可について原則として許可できないケースとして正しいのはどれか。",
        choices: ["小規模住宅建築", "農林漁業用施設", "大規模商業施設"],
        correct: 2,
        exp: "市街化調整区域では原則開発許可が下りず、大規模商業施設は特に不許可です。"
    },
    {
        id: 'Q033',
        category: "法令上の制限",
        q: "建築基準法における既存不適格建築物について増改築時の基準適用として正しいのはどれか。",
        choices: ["全て新基準で改築が必須", "増築部分のみ新基準を適用", "既存部分も新基準を適用"],
        correct: 1,
        exp: "既存不適格建築物を増改築する場合、増築部分のみ新基準を適用します。"
    },
    {
        id: 'Q034',
        category: "法令上の制限",
        q: "国土利用計画法における先買い権について対象となる土地面積の下限として正しいのはどれか。",
        choices: ["100㎡以上", "500㎡以上", "1,000㎡以上"],
        correct: 2,
        exp: "先買い権の対象は1,000㎡以上の土地取得です。"
    },
    {
        id: 'Q035',
        category: "法令上の制限",
        q: "防火地域内での建築物について次のうち誤っているのはどれか。",
        choices: ["鉄筋コンクリート造で耐火建築物に限定される", "延べ面積制限がない", "木造建築が許可される"],
        correct: 2,
        exp: "防火地域内では原則木造建築は許可されません。"
    },
    {
        id: 'Q036',
        category: "法令上の制限",
        q: "建築基準法における容積率について次の内容として正しいのはどれか。",
        choices: ["敷地面積に対する延べ床面積の比率", "1階の床面積に対する屋上面積の比率", "高さ制限と同じもの"],
        correct: 0,
        exp: "容積率は敷地面積に対する延べ床面積（建坪×階数）の比率です。"
    },

    // 税・統計（8問）
    {
        id: 'Q037',
        category: "税・統計",
        q: "令和8年度における住宅ローン控除について最新の控除率として正しいのはどれか。",
        choices: ["0.5%", "1.0%", "1.5%"],
        correct: 1,
        exp: "2024年度から住宅ローン控除は1.0%に統一されました。"
    },
    {
        id: 'Q038',
        category: "税・統計",
        q: "登録免許税における不動産売買時について土地取得の課税標準額の基準として正しいのはどれか。",
        choices: ["実際の売買価格", "固定資産税評価額", "公示価格"],
        correct: 1,
        exp: "登録免許税の課税標準額は固定資産税評価額です。"
    },
    {
        id: 'Q039',
        category: "税・統計",
        q: "不動産鑑定評価基準における『正常価格』と『限定価格』の最大の差異として正しいのはどれか。",
        choices: ["金額の大小", "評価条件の制約", "評価対象物件の種類"],
        correct: 1,
        exp: "限定価格は特定の時間的制約等がある評価条件下での価格です。"
    },
    {
        id: 'Q040',
        category: "税・統計",
        q: "譲渡所得税における長期保有不動産の税率として正しいのはどれか。",
        choices: ["約15%", "約20%", "約39%"],
        correct: 1,
        exp: "長期譲渡所得は約20%（所得税+住民税）です。"
    },
    {
        id: 'Q041',
        category: "税・統計",
        q: "印紙税における売買契約書について100万円超500万円以下の課税額として正しいのはどれか。",
        choices: ["500円", "1,000円", "1,500円"],
        correct: 1,
        exp: "100万円超500万円以下の売買契約書の印紙税は1,000円です。"
    },
    {
        id: 'Q042',
        category: "税・統計",
        q: "相続税における農地の評価方法として選択可能なのはどれか。",
        choices: ["宅地比準方式のみ", "農地評価方式のみ", "両方式から選択可能"],
        correct: 2,
        exp: "宅地比準方式か農地評価方式のいずれかを選択できます。"
    },
    {
        id: 'Q043',
        category: "税・統計",
        q: "2026年度の住宅・土地統計調査における全国の空き家率として一般的な推定値はどれか。",
        choices: ["約10%", "約15%", "約20%"],
        correct: 2,
        exp: "直近の調査では全国の空き家率が約20%に達しています。"
    },
    {
        id: 'Q044',
        category: "税・統計",
        q: "不動産所得における減価償却費の計算について正しいのはどれか。",
        choices: ["建物の購入金額全額が対象", "土地を除いた建物金額が対象", "その年の実績による"],
        correct: 1,
        exp: "減価償却は土地を除いた建物部分に対して計算します。"
    },

    // 5問免除（10問）
    {
        id: 'Q045',
        category: "5問免除",
        q: "住宅金融支援機構の『フラット35』の特徴として最も適切なのはどれか。",
        choices: ["全期間固定金利型", "変動金利型", "固変金利型"],
        correct: 0,
        exp: "フラット35は全期間固定金利が特徴で、35年間金利が変わりません。"
    },
    {
        id: 'Q046',
        category: "5問免除",
        q: "フラット35の融資対象住宅における耐久性基準として鉄筋コンクリート造の場合の基準は何か。",
        choices: ["30年", "45年", "50年"],
        correct: 0,
        exp: "フラット35では鉄筋コンクリート造は30年の耐用年数基準とされています。"
    },
    {
        id: 'Q047',
        category: "5問免除",
        q: "景品表示法における『優良誤認』の定義として最も適切なのはどれか。",
        choices: ["実際より優良と誤認させる表示", "根拠に基づいた正確な表示", "標準的な仕様表示"],
        correct: 0,
        exp: "優良誤認とは実際より『優良』『有利』と誤認させる表示です。"
    },
    {
        id: 'Q048',
        category: "5問免除",
        q: "統計法に基づく『住宅・土地統計調査』の実施周期として正しいのはどれか。",
        choices: ["毎年", "3年ごと", "5年ごと"],
        correct: 2,
        exp: "住宅・土地統計調査は5年ごとに実施される基幹統計です。"
    },
    {
        id: 'Q049',
        category: "5問免除",
        q: "フラット35の融資実行前に実施される『適合審査』について正しいのはどれか。",
        choices: ["着工時に1回", "完成時に1回", "着工時と完成時に各1回"],
        correct: 1,
        exp: "フラット35は完成時に1回の適合審査が実施されます。"
    },
    {
        id: 'Q050',
        category: "5問免除",
        q: "宅地造成資金貸付事業（住宅金融支援機構）の主な目的として最も適切なのはどれか。",
        choices: ["高利益獲得", "勤労者の住宅取得支援", "企業財務支援"],
        correct: 1,
        exp: "勤労者の住宅取得支援が主な政策目的です。"
    },
    {
        id: 'Q051',
        category: "5問免除",
        q: "景品表示法における『有利誤認』の定義として最も適切なのはどれか。",
        choices: ["商品の品質を実際より優良と表示", "取引条件を実際より有利と表示", "価格を高めに表示"],
        correct: 1,
        exp: "有利誤認とは取引条件を実際より有利と誤認させる表示です。"
    },
    {
        id: 'Q052',
        category: "5問免除",
        q: "住宅ローン減税について最新の対象住宅の床面積基準として正しいのはどれか。",
        choices: ["50㎡以上", "75㎡以上", "100㎡以上"],
        correct: 0,
        exp: "最新基準では住宅ローン減税対象は50㎡以上とされています。"
    },
    {
        id: 'Q053',
        category: "5問免除",
        q: "統計法における『統計調査』の実施者として正しいのはどれか。",
        choices: ["民間企業のみ", "国及び地方公共団体", "個人でも可能"],
        correct: 1,
        exp: "正式な統計調査は国と地方公共団体により実施されます。"
    },
    {
        id: 'Q054',
        category: "5問免除",
        q: "住宅金融支援機構の融資審査について、主に重視される点として最も適切なのはどれか。",
        choices: ["担保不動産の市場価格", "返済能力と物件の担保価値", "融資申請者の学歴"],
        correct: 1,
        exp: "返済能力と物件の担保価値のバランスが最重要視されます。"
    }
];

/**
 * ダミーデータ生成関数（1000問対応用）
 * 実際のテキスト作成時の構造化テンプレート
 */
function generateDummyQuestions(count = 1000) {
    const dummy = [];
    const categories = ['権利関係', '宅建業法', '法令上の制限', '税・統計', '5問免除'];
    
    for (let i = BASE_QUESTIONS.length; i < count; i++) {
        const categoryIdx = i % categories.length;
        const category = categories[categoryIdx];
        const correctIdx = Math.floor(Math.random() * 3);
        
        dummy.push({
            id: `Q${String(i + 1).padStart(3, '0')}`,
            category: category,
            q: `[プレースホルダー] 問題${i + 1}：${category}分野に関する法律知識を問う問題です。`,
            choices: [
                `選択肢1（問題${i + 1}）`,
                `選択肢2（問題${i + 1}）`,
                `選択肢3（問題${i + 1}）`
            ],
            correct: correctIdx,
            exp: `これは問題${i + 1}の解説プレースホルダーです。${category}における重要な法律概念について学習してください。`
        });
    }
    
    return dummy;
}

/**
 * 問題データの取得関数
 * @param {number} count - 取得する問題数（nullの場合は全問）
 * @returns {Array} 問題配列
 */
function getQuestions(count = null) {
    let allQuestions = [...BASE_QUESTIONS];
    
    // 必要に応じてダミーデータを生成
    if (count && count > BASE_QUESTIONS.length) {
        const dummyCount = count - BASE_QUESTIONS.length;
        allQuestions = allQuestions.concat(generateDummyQuestions(BASE_QUESTIONS.length + dummyCount));
    } else if (!count) {
        // 全問を返す場合、現在は50問のみ
        return allQuestions;
    }
    
    return allQuestions.slice(0, count);
}

/**
 * カテゴリごとの問題数をカウント
 * @returns {Object} カテゴリごとの問題数
 */
function getQuestionCountByCategory() {
    const counts = {};
    BASE_QUESTIONS.forEach(q => {
        counts[q.category] = (counts[q.category] || 0) + 1;
    });
    return counts;
}

/**
 * IDから問題を検索
 * @param {string} id - 問題ID
 * @returns {Object|null} 問題オブジェクト
 */
function getQuestionById(id) {
    return BASE_QUESTIONS.find(q => q.id === id) || null;
}

// グローバル変数へ割り当て
const allQuizData = BASE_QUESTIONS;

// CommonJS対応（Node.js環境での使用を想定）
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        BASE_QUESTIONS,
        generateDummyQuestions,
        getQuestions,
        getQuestionCountByCategory,
        getQuestionById,
        allQuizData
    };
}
